<%include ./header%>
<!DOCTYPE html>
<html lang="en">
<head>
    <link   rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet"   href="/css/style.css" type="text/css">
    <link  rel="stylesheet" href="/css/main.css" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <style type="text/css">
    @keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}
	.chartjs-render-monitor{animation:chartjs-render-animation 1ms}
	.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}
	.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}
	.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}
    </style>
  </head>
  <body>
    <div id="main-content">
            <div class="container-fluid">
                <div class="block-header">
                    <div class="row">
                        <div class="col-lg-6 col-md-8 col-sm-12">
                            <h2><a href="javascript:void(0);" class="btn btn-xs btn-link btn-toggle-fullwidth"><i class="fa fa-arrow-left"></i></a> Dashboard</h2>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="index.html"><i class="icon-home"></i></a></li>
                                <li class="breadcrumb-item active">Dashboard</li>
                            </ul>
                        </div>

                    </div>
                </div>

                <div class="row clearfix">
                    <div class="col-lg-3 col-md-12">
                        <div class="row clearfix">
                            <div class="col-lg-12 col-md-6">
                                <div class="card top_counter">
                                    <div class="body">
                                        <div id="top_counter1" class="carousel vert slide" data-ride="carousel" data-interval="2500">
                                            <div class="carousel-inner">
                                                <div class="carousel-item">
                                                    <div class="icon"><i class="fa fa-user"></i> </div>
                                                    <div class="content">
                                                        <div class="text">Total Patient</div>
                                                        <h5 class="number">215</h5>
                                                    </div>
                                                </div>
                                                <div class="carousel-item active">
                                                    <div class="icon"><i class="fa fa-user"></i> </div>
                                                    <div class="content">
                                                        <div class="text">New Patient</div>
                                                        <h5 class="number">21</h5>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <hr>
                                        <div id="top_counter2" class="carousel vert slide" data-ride="carousel" data-interval="2100">
                                            <div class="carousel-inner">
                                                <div class="carousel-item">
                                                    <div class="icon"><i class="fa fa-user-md"></i> </div>
                                                    <div class="content">
                                                        <div class="text">Operations</div>
                                                        <h5 class="number">06</h5>
                                                    </div>
                                                </div>
                                                <div class="carousel-item active">
                                                    <div class="icon"><i class="fa fa-user-md"></i> </div>
                                                    <div class="content">
                                                        <div class="text">Surgery</div>
                                                        <h5 class="number">04</h5>
                                                    </div>
                                                </div>
                                                <div class="carousel-item">
                                                    <div class="icon"><i class="fa fa-user-md"></i> </div>
                                                    <div class="content">
                                                        <div class="text">Treatment</div>
                                                        <h5 class="number">23</h5>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                    <div class="col-lg-9 col-md-12">
                                        <div class="card">
                                            <div class="header">
                                                <ul class="header-dropdown">
                                                    <li><a class="tab_btn active" href="javascript:void(0);" onclick="loadYearModal();" title="Yearly">Y</a></li>
                                                </ul>
                                            </div>
                                            <div class="body">
                                        <canvas id="myChart" width="50%" height="20%"></canvas>
                                        </div>
                                    </div>
                  </div>


            </div>
            <div class="row clearfix">
                <div class="col-lg-12 col-md-6">
                  <div class="col-lg-12 col-md-12">
                                      <div class="card">
                                          <div class="header">
                                              <ul class="header-dropdown">
                                                  <li><a class="tab_btn active" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" onclick="loadOperationalYearlyModal();" title="" data-original-title="Yearly">Y</a></li>
                                              </ul>
                                          </div>
                                          <div class="body">
                                            <canvas id="operationChartId" width="50%" height="20%" class="chartjs-render-monitor"></canvas>
                                          </div>
                                      </div>
                                  </div>
                </div>
                </div>
                <div class="row clearfix">
                    <div class="col-lg-12 col-md-6">
                      <div class="col-lg-12 col-md-12">
                                          <div class="card">
                                              <div class="header">
                                                  <ul class="header-dropdown">
                                                      <li><a class="tab_btn active" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" onclick="loadOperationalYearlyModal();" title="" data-original-title="Yearly">Y</a></li>
                                                  </ul>
                                              </div>
                                              <div class="body">
                                              <canvas id="revenueGraph" width="600" height="400"></canvas>
                                              </div>
                                          </div>
                                      </div>
                    </div>
                    </div>
        </div>

    <button type="button" id="launchOperationalYearModalId" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#operationalModal">
    </button>


    <div class="modal fade" id="operationalModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Select Year</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <select class="form-select" aria-label="Default select example" onchange="loadOperationalGraph(this.value)">
          <option value="2021" selected>2021</option>
          <option value="2022">2022</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
        </select>
        <button type="button" id="closeOperationalYearModalId" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>




    <button type="button" id="launchYearModalId" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
    </button>


    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Select Year</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <select class="form-select" aria-label="Default select example" onchange="loadGraph(this.value)">
          <option value="2021" selected>2021</option>
          <option value="2022">2022</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
        </select>
        <button type="button" id="closeYearModalId" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
<!-- <a href="/appointment_user" class="btn btn-primary">Book Appointment</a> -->
    <!-- <br><br><br> -->









<input type="hidden" value="" id="chartYear"/>
<input type="hidden" value="" id="chartOperationYear"/>
</body>
</html>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>
<script src="/js/libscripts.bundle.js"></script>
<script src="/js/vendorscripts.bundle.js"></script>

<script src="/js/chartist.bundle.js" type="text/javascript"></script>
<script src="/js/knob.bundle.js"></script> <!-- Jquery Knob-->
<script src="/js/flotscripts.bundle.js"></script> <!-- flot charts Plugin Js -->
<script src="/js/toastr.js"></script>
<script src="/js/jquery.flot.selection.js"></script>

<script src="/js/mainscripts.bundle.js"></script>
<script src="/js/index.js"></script>
<script type="text/javascript">

$(document).ready(function() {
  $("#closeYearModalId").hide();
  $("#launchYearModalId").hide();
  $("#launchOperationalYearModalId").hide();
  $("#closeOperationalYearModalId").hide();
  var d = new Date();
  var n = d.getFullYear();
  $("#chartYear").val(n);
    $("#chartOperationYear").val(n);
    patientHistoryData("year",n,"0");
    operationHistoryData("year",n,"0");
    revenueData("year",n,"0");
  });


  const operationHistoryData = async (chartType,year,month) => {

      let durationArray = [];
      let PatientCount = [];
      if(chartType == "year")
      {
       durationArray =   ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      PatientCount = ["0","0","0","0","0","0","0","0","0","0","0","0"];
      }
       if(chartType == "month")
       {
         durationArray =   ["01","02","03","04","05","06","07","08","09","10","11","12","13",
         "14","15","16","17","18","19","20","21",
         "22","23","24","25","26","27","28","29","30","31"];
        PatientCount = ["0","0","0","0","0","0","0","0","0","0","0","0","0",
         "0","0","0","0","0","0","0","0",
         "0","0","0","0","0","0","0","0","0","0"];
       }
      await $.ajax({
          url: '/operationHistoryData',
          type: 'GET',
          data:{chartType:chartType,year:year,month:month},
          datatype: 'json',
          success: (response) => {
              if(response !== null){
                  response.forEach(element => {

                     if(chartType == "year")
                     {
                       let month = "-";
                       let monthNumber = element.date;
                           if(monthNumber == "01")
                              PatientCount[0] = element.count;
                            if(monthNumber == "02")
                            PatientCount[1] = element.count;
                            if(monthNumber == "03")
                            PatientCount[2] = element.count;
                            if(monthNumber == "04")
                            PatientCount[3] = element.count;
                            if(monthNumber == "05")
                            PatientCount[4] = element.count;
                            if(monthNumber == "06")
                            PatientCount[5] = element.count;
                            if(monthNumber == "07")
                            PatientCount[6] = element.count;
                            if(monthNumber == "08")
                            PatientCount[7] = element.count;
                            if(monthNumber == "09")
                            PatientCount[8] = element.count;
                            if(monthNumber == "10")
                            PatientCount[9] = element.count;
                            if(monthNumber == "11")
                            PatientCount[10] = element.count;
                            if(monthNumber == "12")
                            PatientCount[11] = element.count;
                     }
                     if(chartType == "month")
                     {
                       let month = "-";
                       let monthNumber = element.date;
                           if(monthNumber == "01")
                              PatientCount[0] = element.count;
                            if(monthNumber == "02")
                            PatientCount[1] = element.count;
                            if(monthNumber == "03")
                            PatientCount[2] = element.count;
                            if(monthNumber == "04")
                            PatientCount[3] = element.count;
                            if(monthNumber == "05")
                            PatientCount[4] = element.count;
                            if(monthNumber == "06")
                            PatientCount[5] = element.count;
                            if(monthNumber == "07")
                            PatientCount[6] = element.count;
                            if(monthNumber == "08")
                            PatientCount[7] = element.count;
                            if(monthNumber == "09")
                            PatientCount[8] = element.count;
                            if(monthNumber == "10")
                            PatientCount[9] = element.count;
                            if(monthNumber == "11")
                            PatientCount[10] = element.count;
                            if(monthNumber == "12")
                            PatientCount[11] = element.count;

                                if(monthNumber == "13")
                                   PatientCount[12] = element.count;
                                 if(monthNumber == "14")
                                 PatientCount[13] = element.count;
                                 if(monthNumber == "15")
                                 PatientCount[14] = element.count;
                                 if(monthNumber == "16")
                                 PatientCount[15] = element.count;
                                 if(monthNumber == "17")
                                 PatientCount[16] = element.count;
                                 if(monthNumber == "18")
                                 PatientCount[17] = element.count;
                                 if(monthNumber == "19")
                                 PatientCount[18] = element.count;
                                 if(monthNumber == "20")
                                 PatientCount[19] = element.count;
                                 if(monthNumber == "21")
                                 PatientCount[20] = element.count;
                                 if(monthNumber == "22")
                                 PatientCount[21] = element.count;
                                 if(monthNumber == "23")
                                 PatientCount[22] = element.count;
                                 if(monthNumber == "24")
                                 PatientCount[23] = element.count;
                                 if(monthNumber == "25")
                                 PatientCount[24] = element.count;
                                 if(monthNumber == "26")
                                 PatientCount[25] = element.count;
                                 if(monthNumber == "27")
                                 PatientCount[26] = element.count;
                                 if(monthNumber == "28")
                                 PatientCount[27] = element.count;
                                 if(monthNumber == "29")
                                 PatientCount[28] = element.count;
                                 if(monthNumber == "30")
                                 PatientCount[29] = element.count;
                                 if(monthNumber == "31")
                                 PatientCount[30] = element.count;
                     }
                  }


                );
            }
          },
          error: (err) => {
              console.log(err);
          }
      })

      var canvas = document.getElementById('operationChartId');
    var data = {
        labels: durationArray,
        datasets: [
            {
                label: "Operation History ",
                backgroundColor: "rgba(255,99,132,0.2)",
                borderColor: "rgba(255,99,132,1)",
                borderWidth: 2,
                hoverBackgroundColor: "rgba(255,99,132,0.4)",
                hoverBorderColor: "rgba(255,99,132,1)",
                data: PatientCount,
            }
        ]
    };
    var option = {
    animation: {
    				duration:5000
    },
    onClick: chartOperationClickEvent

    };


    var myLineChart = Chart.Line(canvas,{
    	data:data,
      options:option
    });

  }







const patientHistoryData = async (chartType,year,month) => {

    let durationArray = [];
    let PatientCount = [];
    if(chartType == "year")
    {
     durationArray =   ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    PatientCount = ["0","0","0","0","0","0","0","0","0","0","0","0"];
    }
     if(chartType == "month")
     {
       durationArray =   ["01","02","03","04","05","06","07","08","09","10","11","12","13",
       "14","15","16","17","18","19","20","21",
       "22","23","24","25","26","27","28","29","30","31"];
      PatientCount = ["0","0","0","0","0","0","0","0","0","0","0","0","0",
       "0","0","0","0","0","0","0","0",
       "0","0","0","0","0","0","0","0","0","0"];
     }
    await $.ajax({
        url: '/patientHistoryData',
        type: 'GET',
        data:{chartType:chartType,year:year,month:month},
        datatype: 'json',
        success: (response) => {
            if(response !== null){
                response.forEach(element => {

                   if(chartType == "year")
                   {
                     let month = "-";
                     let monthNumber = element.date;
                         if(monthNumber == "01")
                            PatientCount[0] = element.count;
                          if(monthNumber == "02")
                          PatientCount[1] = element.count;
                          if(monthNumber == "03")
                          PatientCount[2] = element.count;
                          if(monthNumber == "04")
                          PatientCount[3] = element.count;
                          if(monthNumber == "05")
                          PatientCount[4] = element.count;
                          if(monthNumber == "06")
                          PatientCount[5] = element.count;
                          if(monthNumber == "07")
                          PatientCount[6] = element.count;
                          if(monthNumber == "08")
                          PatientCount[7] = element.count;
                          if(monthNumber == "09")
                          PatientCount[8] = element.count;
                          if(monthNumber == "10")
                          PatientCount[9] = element.count;
                          if(monthNumber == "11")
                          PatientCount[10] = element.count;
                          if(monthNumber == "12")
                          PatientCount[11] = element.count;
                   }
                   if(chartType == "month")
                   {
                     let month = "-";
                     let monthNumber = element.date;
                         if(monthNumber == "01")
                            PatientCount[0] = element.count;
                          if(monthNumber == "02")
                          PatientCount[1] = element.count;
                          if(monthNumber == "03")
                          PatientCount[2] = element.count;
                          if(monthNumber == "04")
                          PatientCount[3] = element.count;
                          if(monthNumber == "05")
                          PatientCount[4] = element.count;
                          if(monthNumber == "06")
                          PatientCount[5] = element.count;
                          if(monthNumber == "07")
                          PatientCount[6] = element.count;
                          if(monthNumber == "08")
                          PatientCount[7] = element.count;
                          if(monthNumber == "09")
                          PatientCount[8] = element.count;
                          if(monthNumber == "10")
                          PatientCount[9] = element.count;
                          if(monthNumber == "11")
                          PatientCount[10] = element.count;
                          if(monthNumber == "12")
                          PatientCount[11] = element.count;

                              if(monthNumber == "13")
                                 PatientCount[12] = element.count;
                               if(monthNumber == "14")
                               PatientCount[13] = element.count;
                               if(monthNumber == "15")
                               PatientCount[14] = element.count;
                               if(monthNumber == "16")
                               PatientCount[15] = element.count;
                               if(monthNumber == "17")
                               PatientCount[16] = element.count;
                               if(monthNumber == "18")
                               PatientCount[17] = element.count;
                               if(monthNumber == "19")
                               PatientCount[18] = element.count;
                               if(monthNumber == "20")
                               PatientCount[19] = element.count;
                               if(monthNumber == "21")
                               PatientCount[20] = element.count;
                               if(monthNumber == "22")
                               PatientCount[21] = element.count;
                               if(monthNumber == "23")
                               PatientCount[22] = element.count;
                               if(monthNumber == "24")
                               PatientCount[23] = element.count;
                               if(monthNumber == "25")
                               PatientCount[24] = element.count;
                               if(monthNumber == "26")
                               PatientCount[25] = element.count;
                               if(monthNumber == "27")
                               PatientCount[26] = element.count;
                               if(monthNumber == "28")
                               PatientCount[27] = element.count;
                               if(monthNumber == "29")
                               PatientCount[28] = element.count;
                               if(monthNumber == "30")
                               PatientCount[29] = element.count;
                               if(monthNumber == "31")
                               PatientCount[30] = element.count;
                   }
                }


              );
          }
        },
        error: (err) => {
            console.log(err);
        }
    })

    var canvas = document.getElementById('myChart');
  var data = {
      labels: durationArray,
      datasets: [
          {
              label: "Patient History ",
              backgroundColor: "rgba(255,99,132,0.2)",
              borderColor: "rgba(255,99,132,1)",
              borderWidth: 2,
              hoverBackgroundColor: "rgba(255,99,132,0.4)",
              hoverBorderColor: "rgba(255,99,132,1)",
              data: PatientCount,
          }
      ]
  };
  var option = {
  animation: {
  				duration:5000
  },
  onClick: chartClickEvent

  };


  var myBarChart = Chart.Bar(canvas,{
  	data:data,
    options:option
  });

}
function chartClickEvent (event, array)
{
  let year = $("#chartYear").val();
  patientHistoryData("month",year,array[0]._index);
}

function chartOperationClickEvent(event,array)
{
  let year = $("#chartOperationYear").val();
  operationHistoryData("month",year,array[0]._index);
}
function loadGraph(value)
{
  $("#chartYear").val(value);
  patientHistoryData("year",value,"0");
  $("#closeYearModalId").click();
}

function loadYearModal()

{
  $("#launchYearModalId").click();
}

function loadOperationalYearlyModal()
{
  $("#launchOperationalYearModalId").click();
}

function loadOperationalGraph(value)
{
  $("#chartOperationYear").val(value);
  operationHistoryData("year",value,"0");
  $("#closeOperationalYearModalId").click();
}




const revenueData = async (chartType,year,month) => {

    let durationArray = [];
    let medicineCount = [];
    let operationCount = [];

    if(chartType == "year")
    {
     durationArray =   ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
     medicineCount = ["0","0","0","0","0","0","0","0","0","0","0","0"];
     operationCount = ["0","0","0","0","0","0","0","0","0","0","0","0"];
    }
     if(chartType == "month")
     {
       durationArray =   ["01","02","03","04","05","06","07","08","09","10","11","12","13",
       "14","15","16","17","18","19","20","21",
       "22","23","24","25","26","27","28","29","30","31"];
      medicineCount = ["0","0","0","0","0","0","0","0","0","0","0","0","0",
       "0","0","0","0","0","0","0","0",
       "0","0","0","0","0","0","0","0","0","0"];
       operationCount = ["0","0","0","0","0","0","0","0","0","0","0","0","0",
        "0","0","0","0","0","0","0","0",
        "0","0","0","0","0","0","0","0","0","0"];
     }
    await $.ajax({
        url: '/revenueData',
        type: 'GET',
        data:{chartType:chartType,year:year,month:month},
        datatype: 'json',
        success: (response) => {
            if(response !== null){
                response.forEach(element => {

                   if(chartType == "year")
                   {
                     let month = "-";
                     let monthNumber = element.date;
                         if(monthNumber == "01")
                            medicineCount[0] = element.medicine;
                          if(monthNumber == "02")
                          medicineCount[1] = element.medicine;
                          if(monthNumber == "03")
                          medicineCount[2] = element.medicine;
                          if(monthNumber == "04")
                          medicineCount[3] = element.medicine;
                          if(monthNumber == "05")
                          medicineCount[4] = element.medicine;
                          if(monthNumber == "06")
                          medicineCount[5] = element.medicine;
                          if(monthNumber == "07")
                          medicineCount[6] = element.medicine;
                          if(monthNumber == "08")
                          medicineCount[7] = element.medicine;
                          if(monthNumber == "09")
                          medicineCount[8] = element.medicine;
                          if(monthNumber == "10")
                          medicineCount[9] = element.medicine;
                          if(monthNumber == "11")
                          medicineCount[10] = element.medicine;
                          if(monthNumber == "12")
                          medicineCount[11] = element.medicine;
                   }

                }


              );
          }
        },
        error: (err) => {
            console.log(err);
        }
    })

    var revenueGraph = document.getElementById("revenueGraph");

    Chart.defaults.global.defaultFontFamily = "Lato";
    Chart.defaults.global.defaultFontSize = 18;

    var MedicineData = {
      label: 'Medicine Revenue',
      data: medicineCount,
      backgroundColor: 'rgba(0, 99, 132, 0.6)',
      borderWidth: 0,
      yAxisID: "y-axis-density"
    };

    var operationData = {
      label: 'Operation Revenue',
      data: operationCount,
      backgroundColor: 'rgba(99, 132, 0, 0.6)',
      borderWidth: 0,
      yAxisID: "y-axis-gravity"
    };

    var revenueGraphData = {
      labels: durationArray,
      datasets: [MedicineData, operationData]
    };

    var chartOptions = {
      scales: {
        xAxes: [{
          barPercentage: 1,
          categoryPercentage: 0.6
        }],
        yAxes: [{
          id: "y-axis-density"
        }, {
          id: "y-axis-gravity"
        }]
      }
    };

    var barChart = new Chart(revenueGraph, {
      type: 'bar',
      data: revenueGraphData,
      options: chartOptions
    });
}
</script>
