<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link  href="/stylesheet/bootstrap.min.css" type="text/css">
    <link  href="/stylesheet/style.css" type="text/css">
    <link  href="/stylesheet/main.css" type="text/css">
</head>
<body>

    <a href="/appointment_user" class="btn btn-primary">Book Appointment</a>
    <br><br><br>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 p-1">
                <div class="card bg-light mb-3 shadow">
                    <div class="card-body">
                        <div id="barChart"></div>
                    </div>
                </div>

<input type="hidden" value="" id="chartYear"/>
</body>
</html>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="/js/chartist.bundle.js" type="text/javascript"></script>

<script type="text/javascript">
var modal = document.getElementById("myModal");


var btn = document.getElementById("myBtn");


var span = document.getElementsByClassName("close")[0];


btn.onclick = function() {
  modal.style.display = "block";
}


span.onclick = function() {
  modal.style.display = "none";
}


window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
$(document).ready(function() {
  var d = new Date();
  var n = d.getFullYear();
  $("#chartYear").val(n);
    patientHistoryData("year",n,"0");
  });

const patientHistoryData = async (chartType,year,month) => {

    let durationArray = [];
    let PatientCount = [];
    if(chartType == "year")
    {
     durationArray =   ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    PatientCount = ["0","0","0","0","0","0","0","0","0","0","0","0"];
    }
     if(chartType == "month")
     {
       durationArray =   ["01","02","03","04","05","06","07","08","09","10","11","12","13",
       "14","15","16","17","18","19","20","21",
       "22","23","24","25","26","27","28","29","30","31"];
      PatientCount = ["0","0","0","0","0","0","0","0","0","0","0","0","0",
       "0","0","0","0","0","0","0","0",
       "0","0","0","0","0","0","0","0","0","0"];
     }
    await $.ajax({
        url: '/patientHistoryData',
        type: 'GET',
        data:{chartType:chartType,year:year,month:month},
        datatype: 'json',
        success: (response) => {
            if(response !== null){
                response.forEach(element => {

                   if(chartType == "year")
                   {
                     let month = "-";
                     let monthNumber = element.date;
                         if(monthNumber == "01")
                            PatientCount[0] = element.count;
                          if(monthNumber == "02")
                          PatientCount[1] = element.count;
                          if(monthNumber == "03")
                          PatientCount[2] = element.count;
                          if(monthNumber == "04")
                          PatientCount[3] = element.count;
                          if(monthNumber == "05")
                          PatientCount[4] = element.count;
                          if(monthNumber == "06")
                          PatientCount[5] = element.count;
                          if(monthNumber == "07")
                          PatientCount[6] = element.count;
                          if(monthNumber == "08")
                          PatientCount[7] = element.count;
                          if(monthNumber == "09")
                          PatientCount[8] = element.count;
                          if(monthNumber == "10")
                          PatientCount[9] = element.count;
                          if(monthNumber == "11")
                          PatientCount[10] = element.count;
                          if(monthNumber == "12")
                          PatientCount[11] = element.count;
                   }
                   if(chartType == "month")
                   {
                     let month = "-";
                     let monthNumber = element.date;
                         if(monthNumber == "01")
                            PatientCount[0] = element.count;
                          if(monthNumber == "02")
                          PatientCount[1] = element.count;
                          if(monthNumber == "03")
                          PatientCount[2] = element.count;
                          if(monthNumber == "04")
                          PatientCount[3] = element.count;
                          if(monthNumber == "05")
                          PatientCount[4] = element.count;
                          if(monthNumber == "06")
                          PatientCount[5] = element.count;
                          if(monthNumber == "07")
                          PatientCount[6] = element.count;
                          if(monthNumber == "08")
                          PatientCount[7] = element.count;
                          if(monthNumber == "09")
                          PatientCount[8] = element.count;
                          if(monthNumber == "10")
                          PatientCount[9] = element.count;
                          if(monthNumber == "11")
                          PatientCount[10] = element.count;
                          if(monthNumber == "12")
                          PatientCount[11] = element.count;

                              if(monthNumber == "13")
                                 PatientCount[12] = element.count;
                               if(monthNumber == "14")
                               PatientCount[13] = element.count;
                               if(monthNumber == "15")
                               PatientCount[14] = element.count;
                               if(monthNumber == "16")
                               PatientCount[15] = element.count;
                               if(monthNumber == "17")
                               PatientCount[16] = element.count;
                               if(monthNumber == "18")
                               PatientCount[17] = element.count;
                               if(monthNumber == "19")
                               PatientCount[18] = element.count;
                               if(monthNumber == "20")
                               PatientCount[19] = element.count;
                               if(monthNumber == "21")
                               PatientCount[20] = element.count;
                               if(monthNumber == "22")
                               PatientCount[21] = element.count;
                               if(monthNumber == "23")
                               PatientCount[22] = element.count;
                               if(monthNumber == "24")
                               PatientCount[23] = element.count;
                               if(monthNumber == "25")
                               PatientCount[24] = element.count;
                               if(monthNumber == "26")
                               PatientCount[25] = element.count;
                               if(monthNumber == "27")
                               PatientCount[26] = element.count;
                               if(monthNumber == "28")
                               PatientCount[27] = element.count;
                               if(monthNumber == "29")
                               PatientCount[28] = element.count;
                               if(monthNumber == "30")
                               PatientCount[29] = element.count;
                               if(monthNumber == "31")
                               PatientCount[30] = element.count;
                   }
                }


              );
          }
        },
        error: (err) => {
            console.log(err);
        }
    })
    console.log(PatientCount);
    var canvas = document.getElementById('myChart');
  var data = {
      labels: durationArray,
      datasets: [
          {
              label: "Patient History ",
              backgroundColor: "rgba(255,99,132,0.2)",
              borderColor: "rgba(255,99,132,1)",
              borderWidth: 2,
              hoverBackgroundColor: "rgba(255,99,132,0.4)",
              hoverBorderColor: "rgba(255,99,132,1)",
              data: PatientCount,
          }
      ]
  };
  var option = {
  animation: {
  				duration:5000
  },
  onClick: chartClickEvent

  };


  var myBarChart = Chart.Bar(canvas,{
  	data:data,
    options:option
  });

}
function chartClickEvent (event, array)
{
  let year = $("#chartYear").val();
  patientHistoryData("month",year,array[0]._index);
}
function loadGraph(value)
{
  $("#chartYear").val(value);
  patientHistoryData("year",value,"0");
    modal.style.display = "none";
}
</script>
